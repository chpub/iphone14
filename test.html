<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <style>body{margin:0;padding:0;font-family: 'Noto Sans KR', sans-serif;overflow: hidden;height: 100%;}</style>
                    <div class="inner" style="padding:15.0427vw 7.2650vw 57.2650vw; text-align:center;">
                        <img src="./images/icon/ico_exclamation mark.svg" alt="" style="width:21.3675vw;">
                        <h2 style='padding-top:8.5470vw; padding-bottom:3.4188vw; margin:0; font-size:6.1538vw; font-weight:bold; text-align:center; font-family:Noto Sans KR, sans-serif;'>인앱브라우저 호환문제로 인해<br />Safari로 접속해야합니다.</h2>
                        <article style='text-align:center; font-size:4.1026vw; word-break:keep-all;color:#999;'>아래 버튼을 눌러 Safari를 실행해주세요<br />Safari가 열리면, 주소창을 길게 터치한 뒤,<br />'붙여놓기 및 이동'을 누르면<br />정상적으로 이용할 수 있습니다.
                        <button id='bClipboard' data-clipboard-text='http://106.10.43.161/mbti' onclick='inappbrowserout();' style='width:59.8291vw; margin-top:8.5470vw; height:13.6752vw; font-size:3.9316vw; font-weight:700; background-color:#000;color:#fff;border-radius:6.8376vw;font-size:17px;border:0;'>Safari로 열기</button>
                        </article>
                    </div>
    <script>
        $(window).resize(function () {
            var zoneH = $('.adorn_zone').width();
            zoneH = zoneH * 5 / 4;
            $('.adorn_zone').height(zoneH);
        }); // window resize

        function inappbrowserout() {
            // 클립보드 해시태그 복사
            var clipboard = new ClipboardJS('#bClipboard');
            clipboard.on('success', function (e) {
                console.log("Text copied to clipboard...")
            });
            clipboard.on('error', function (e) {
                console.log('Something went wrong', err);
            });

            alert('URL주소가 복사되었습니다.\n\nSafari가 열리면 주소창을 길게 터치한 뒤, "붙여놓기 및 이동"를 누르면 정상적으로 이용하실 수 있습니다.');

            location.href='x-web-search://?';
        }

        $(document).ready(function () {

            if (isMobileIphone()) {
                //모바일대응뷰포트강제설정
                var mobile = document.createElement('meta');
                mobile.name = 'viewport';
                mobile.content = "width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, minimal-ui";
                document.getElementsByTagName('head')[0].appendChild(mobile);

                //노토산스폰트강제설정
                var fonts = document.createElement('link');
                fonts.href = 'https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap';
                document.getElementsByTagName('head')[0].appendChild(fonts);
                document.body.innerHTML = 
                    "<style>body{margin:0; padding:0; font-family: 'Noto Sans KR', sans-serif; overflow:hidden; height:100%;}</style>" +
                    "<div class='inner' style='padding:15.0427vw 7.2650vw 57.2650vw; text-align:center;'>" +
                        "<img src='./images/icon/ico_exclamation mark.svg' alt='' style='width:21.3675vw;'>" +
                        "<h2 style='padding-top:8.5470vw; padding-bottom:3.4188vw; margin:0; font-size:6.1538vw; font-weight:bold; text-align:center; font-family:Noto Sans KR, sans-serif;'>인앱브라우저 호환문제로 인해<br />Safari로 접속해야합니다.</h2>" +
                        "<article style='text-align:center; font-size:4.1026vw; word-break:keep-all;color:#999;'>아래 버튼을 눌러 Safari를 실행해주세요<br />Safari가 열리면, 주소창을 길게 터치한 뒤,<br />'붙여놓기 및 이동'을 누르면<br />정상적으로 이용할 수 있습니다.<br /><br />" +
                        "<button id='bClipboard' data-clipboard-text='http://106.10.43.161/mbti' onclick='inappbrowserout();' style='width:59.8291vw; margin-top:8.5470vw; height:13.6752vw; font-size:3.9316vw; font-weight:700; background-color:#000;color:#fff;border-radius:6.8376vw;font-size:17px;border:0;'>Safari로 열기</button>" +
                        "</article>" +
                    "</div>";
            }

            var s = document.createElement("script");

            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                s.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-alpha1/html2canvas.min.js";
            } else {
                s.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
            }

            $("head").append(s);

            var zoneH = $('.adorn_zone').width();
            zoneH = zoneH * 5 / 4;
            $('.adorn_zone').height(zoneH);

            // background first image fix
            var bgVal = $('input:radio[id="bg01"]').val();
            $('.adorn_zone .adorn_bg').css('background-image', 'url(' + bgVal + ')');

            // background
            $('input:radio[name="bg_sel"]').on('change', function () {
                var bgVal = $('input:radio[name="bg_sel"]:checked').val();

                $('.adorn_zone .adorn_bg').css('background-image', 'url(' + bgVal + ')');
                $('.adorn_info').addClass('active');

                adorn_pop_close();
            });

            $("#uploadFile").on("change", function (event) {
                var file = event.target.files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('.adorn_zone .adorn_bg').css('background-image', 'url(' + e.target.result + ')');
                }
                reader.readAsDataURL(file);

                $('input:radio[name="bg_sel"]').prop("checked", false);
                $('.adorn_info').addClass('active');
            });


            // sticker img
            $('.adorn_stk_sel li button').on('click', function () {
                var stkImg = $(this).find('img').attr('src');
                stickerMake(stkImg);

                adorn_pop_close();
            });


            // sticker tex
            $('#tex_area').on({
                // click: function(){
                // 	if(! $('.sticker.active').find('.text').length) {
                // 		stickerMake();
                // 	}
                // },
                keyup: function () {
                    // $(this).css('height', '78px');
                    // $(this).height(this.scrollHeight);

                    var texVal = $(this).val();
                    texVal = texVal.replaceAll("\n", "<br>");

                    $('.sticker.active').find('.text').html(texVal);

                    if ($('.sticker.active').find('.text').hasClass('new')) {
                        var itemId = $('.sticker.active').attr('id');
                        var itemleft = ($('.adorn_zone').width() / 2) - ($('#' + itemId).width() / 2);

                        $('#' + itemId).css({'left': itemleft});
                    }
                },
            });

            $('#tex_comp').on('click', function () {
                var texVal = $('#tex_area').val();
                if (texVal) {
                    texVal = texVal.replaceAll("\n", "<br>");
                    if (!$('.sticker.active').find('.text').length) {
                        stickerMake();
                    }
                    $('.sticker.active').find('.text').html(texVal);

                    $('.adorn_tex_area.adorn_pop').removeClass('active');
                    setTimeout(function () {
                        $('.adorn_tex_area.adorn_pop').fadeOut(100);
                    }, 200);
                }
            });

            $('input:radio[name="font_siz"]').on('change', function () {
                var fonSizVal = $('input:radio[name="font_siz"]:checked').val();
                $('.sticker.active').find('.text').css('font-size', fonSizVal);
                adorn_pop_close();
            });

            $('input:radio[name="font_col"]').on('change', function () {
                var fonColVal = $('input:radio[name="font_col"]:checked').val();
                $('.sticker.active').find('.text').css('color', fonColVal);
                adorn_pop_close();
            });


            // adorn_zone bg
            $('.adorn_zone .adorn_bg').on('click', function () {
                selReset();
                adorn_pop_close();
            });


            // adron_item_btn - mo pop
            $('.item_bg button').on('click', function () {
                selReset();
                $('.adorn_bg_list.adorn_pop').fadeIn(100, function () {
                    $('.adorn_bg_list.adorn_pop').addClass('active');
                });
            });

            $('.item_stk button').on('click', function () {
                selReset();
                $('.adorn_stk_list.adorn_pop').fadeIn(100, function () {
                    $('.adorn_stk_list.adorn_pop').addClass('active');
                });
            });

            $('.item_tex button').on('click', function () {
                selReset();
                $('.adorn_tex_area.adorn_pop').fadeIn(100, function () {
                    $('.adorn_tex_area.adorn_pop').addClass('active');
                });
                $('#tex_area').focus();
            });

            $('.adorn_pop .adorn_pop_close').on('click', function () {
                adorn_pop_close();
            });

        });


        var itemCount = 0;

        function stickerMake(src) {
            $('.adorn_zone, .adorn_info').addClass('active');
            selReset();

            itemCount = itemCount + 1;

            var itemId = itemCount.toString().length < 2 ? '0' + itemCount : itemCount;
            itemId = 'item_' + itemId;

            $('.adorn_zone').append('<div class="sticker active" id="' + itemId + '"></div>');

            if (src) {
                $('#' + itemId).append('<img src="' + src + '" id="img_' + itemId + '">');

                $('#' + itemId).resizable({
                    aspectRatio: true,
                    // handles: "n, e, s, w, se, sw, nw, ne",
                    handles: "se"
                });

                // 2022.10.07 추가
                setTimeout(function () {
                    var itemImgW = $('#' + itemId).find('img').width();
                    var itemImgH = $('#' + itemId).find('img').height();
                    $('#' + itemId).css({'width': itemImgW, 'height': itemImgH});
                }, 1);
            } else {
                $('#' + itemId).append('<div class="text new"></div>');
                $('#' + itemId).append('<button type="button" class="edit"><span class="blind">edit</span></button>');
                $('#' + itemId).append('<button type="button" class="opt"><span class="blind">option</span></button>');

                var fonSizVal = $('input:radio[name="font_siz"]:checked').val();
                var fonColVal = $('input:radio[name="font_col"]:checked').val();
                $('#' + itemId).find('.text').css({'font-size': fonSizVal, 'color': fonColVal});
            }

            $('#' + itemId).append('<button type="button" class="del"><span class="blind">delete</span></button>');

            $('#' + itemId).rotatable().draggable();

            setTimeout(function () {
                var itemTop = ($('.adorn_zone').height() / 2) - ($('#' + itemId).height() / 2);
                var itemleft = ($('.adorn_zone').width() / 2) - ($('#' + itemId).width() / 2);
                $('#' + itemId).css({'left': itemleft, 'top': itemTop});
            }, 10);

            // sticker event
            $('#' + itemId).on('click touchstart mousedown', function () {

                selReset();

                $(this).addClass('active');
                $('.adorn_zone').append($(this));

                if ($(this).find('.text').length) {
                    var texSel = $(this).find('.text').html();
                    texSel = texSel.replaceAll("<br>", "\n");

                    var texColVal = $(this).find('.text').css('color');
                    texColVal = rgb2hex(texColVal);

                    var texSizVal = $(this).find('.text').css('font-size');

                    $('#tex_area').val(texSel);
                    // $('#tex_area').height($('#tex_area')[0].scrollHeight);
                    $('#tex_area').focus();

                    $('input:radio[name="font_col"][value="' + texColVal + '"]').prop("checked", true);
                    $('input:radio[name="font_siz"][value="' + texSizVal + '"]').prop("checked", true);

                    $(this).find('.text').removeClass('new');
                } else {
                    adorn_pop_close();
                }
            });

            $('#' + itemId).find('.del').on('click touchstart mousedown', function () {
                $(this).closest('.sticker').remove();
                selReset();

                var stFalse = !$('.adorn_zone').find('.sticker').length;
                if (stFalse) {
                    $('.adorn_zone, .adorn_info').removeClass('active'); // 스티커를 생성하고 나서 삭제시 가이드부분 미노출 (.adron_info 삭제)
                }

            });

            $('#' + itemId).find('.edit').on('click touchstart mousedown', function () {
                $('.adorn_tex_area.adorn_pop').fadeIn(100, function () {
                    $('.adorn_tex_area.adorn_pop').addClass('active');
                });
            });

            $('#' + itemId).find('.opt').on('click touchstart mousedown', function () {
                $('.adorn_tex_opt.adorn_pop').fadeIn(100, function () {
                    $('.adorn_tex_opt.adorn_pop').addClass('active');
                });
            });

        } // stickerMake()


        function selReset() {
            $('.sticker').removeClass('active');
            $('#tex_area').val('');
            $('#tex_area').css('height', '');
            $('input:radio[name="font_siz"]#foSize01').prop("checked", true);
            $('input:radio[name="font_col"]#foColor09').prop("checked", true);
        } // selReset()


        function adorn_pop_close() {
            $('.adorn_pop').removeClass('active');
            setTimeout(function () {
                $('.adorn_pop').fadeOut(100);
            }, 200);
        } // selReset()


        function rgb2hex(rgb) {
            rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);

            function hex(x) {
                return ("0" + parseInt(x).toString(16)).slice(-2);
            }

            return "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
        } // rgb2hex()


        // 2022.10.04 수정
        function adornComplete() {
            if (!$('.adorn_zone').hasClass('active')) {
                // alert('배경화면을 꾸며주세요');
                $('#alert01').show(); // 2022.10.04 추가
            } else {
                $('.sticker').removeClass('active');

                var div_adorn_zone = document.getElementById('adorn_zone');
                var rand_0_100 = Math.floor(Math.random() * 101);

                html2canvas(div_adorn_zone).then(function (canvas) {
                    var extra_canvas = document.createElement('canvas');
                    extra_canvas.width = 2026;
                    extra_canvas.height = 2532;
                    extra_canvas.getContext('2d').drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, extra_canvas.width, extra_canvas.height);

                    var myImage = document.createElement('a');
                    myImage.href = extra_canvas.toDataURL('image/jpeg');
                    myImage.download = 'mbti_' + rand_0_100 + '.jpeg';

                    myImage.click();
                });

                // 클립보드 해시태그 복사
                var clipboard = new ClipboardJS('#clipboard');
                clipboard.on('success', function (e) {
                    console.log("Text copied to clipboard...")
                });

                clipboard.on('error', function (e) {
                    console.log('Something went wrong', err);
                });

                $('#alert02, .dim').show(); // 2022.10.04 추가
                $('body').css('overflow', 'hidden') // 2022.10.04 추가
            }


            $('#hashtagbtn').on('click', function () {
                $('#alert02, .dim').hide(); // 2022.10.04 추가
                $('body').attr('style', '') // 2022.10.04 추가
                window.open('https://www.instagram.com/');
            });

            setTimeout(function () {
                document.getElementById("alert01").style.display = "none";
            }, 3000);

        } // adornComplete()

        function isMobileIphone() {
            if (navigator.userAgent.match(/inapp|NAVER|KAKAOTALK|Snapchat|Line|WirtschaftsWoche|Thunderbird|Instagram|everytimeApp|WhatsApp|Electron|wadiz|AliApp|zumapp|iPhone(.*)Whale|Android(.*)Whale|kakaostory|band|twitter|DaumApps|DaumDevice\/mobile|FB_IAB|FB4A|FBAN|FBIOS|FBSS|SamsungBrowser\/[^1]/i)) {
                if (navigator.userAgent.match(/iPhone|iPad/i)) {
                    return true;
                } else {
                    return false;
                }
            } else {
                return false;
            }
        }
    </script>
</body>
</html>